%% E_eqGraphite
% E^eq (Graphite)
function E_eq = E_eqGraphite_NREL(x,T)
    A=[...
    -1.059423355572770E-02,-1.453708425609560E-02,9.089868397988610E-05,...
     2.443615203087110E-02,-5.464261369950400E-01,6.270508166379020E-01,...
    -1.637520788053810E-02,-5.639025014475490E-01,7.053886409518520E-02,...
    -6.542365622896410E-02,-5.960370524233590E-01,1.409966536648620E+00,...
    -4.173226059293490E-02,-1.787670587868640E-01,7.693844911793470E-02,...
    -4.792178163846890E-01, 3.845707852011820E-03,4.112633446959460E-02,...
     6.594735004847470E-01];

    B=[...
   -4.364293924074990E-02,-9.449231893318330E-02,-2.046776012570780E-02,...
   -8.241166396760410E-02,-7.746685789572230E-02, 3.593817905677970E-02,...
    ];

    C=[-1.731504647676420E+02, 8.252008712749000E+01,...
        1.233160814852810E+02, 5.913206621637760E+01,...
        3.322960033709470E+01, 3.437968012320620E+00,...
       -6.906367679257650E+01,-1.228217254296760E+01,...
       -5.037944982759270E+01];

    D=[...
    1.059423355572770E-02,-1.453708425609560E-02,9.089868397988610E-05,...
    2.443615203087110E-02,-5.464261369950400E-01,6.270508166379020E-01,...
   -1.637520788053810E-02,-5.639025014475490E-01,7.053886409518520E-02,...
   -6.542365622896410E-02,-5.960370524233590E-01,1.409966536648620E+00,...
   -4.173226059293490E-02,-1.787670587868640E-01,7.693844911793470E-02,...
   -4.792178163846890E-01, 3.845707852011820E-03,4.112633446959460E-02,...
    6.594735004847470E-01]; 

    E=[...
   -4.364293924074990E-02,-9.449231893318330E-02,-2.046776012570780E-02,...
   -8.241166396760410E-02,-7.746685789572230E-02, 3.593817905677970E-02,...
        ];
    F = -1.02956203215198;

    Eeq_function = @(x) ...
          A( 1).*tanh((x + A( 2)) ./ A( 3)) ...
        + A( 4).*tanh((x + A( 5)) ./ A( 6)) ...
        + A( 7).*tanh((x + A( 8)) ./ A( 9)) ...
        + A(10).*tanh((x + A(11)) ./ A(12)) ...
        + A(13).*tanh((x + A(14)) ./ A(15)) ...
        + A(16).*tanh((x + A(17)) ./ A(18)) ...
        + A(19) ...
        ...
        + B( 1).*tanh((x + B( 2)) ./ B( 3)) ...
        + B( 4).*tanh((x + B( 5)) ./ B( 6)) ...
        ...
        +( (  C(1).*x.^8 + C(2).*x.^7 + C(3).*x.^6 + C(4).*x.^5 ...
            + C(5).*x.^4 + C(6).*x.^3 + C(7).*x.^2 + C(8).*x + C(9) ) ...
           ...
           +D( 1).*tanh((x + D( 2)) ./ D( 3)) ...
           +D( 4).*tanh((x + D( 5)) ./ D( 6)) ...
           +D( 7).*tanh((x + D( 8)) ./ D( 9)) ...
           +D(10).*tanh((x + D(11)) ./ D(12)) ...
           +D(13).*tanh((x + D(14)) ./ D(15)) ...
           +D(16).*tanh((x + D(17)) ./ D(18)) ...
           +D(19) ...
           ...
           +E(1).*tanh((x + E(2)) ./ E(3)) ...
           +E(4).*tanh((x + E(5)) ./ E(6)) ...
          ) ./ (  1.0+exp(-1.0e2.*(x + F(1)))  );

    try
        if x <= 0
            E_eq = 10;
        elseif x > 1 
            E_eq = -10;
        else
            E_eq = real(Eeq_function(x));
        end
    catch
        E_eq = real(Eeq_function(x));
    end
    
    % Plot the OCV if plotFlag == 1
%     if plotFlag == 1
%         y = linspace(0.01,0.99,100);
%         for i = 1:length(y)
%             if y(i) <= 0
%                 Eeq_plt(i) = 10;
%             elseif y(i) > 1 
%                 Eeq_plt(i) = -10;
%             else
%                 Eeq_plt(i) = real(Eeq_function(y(i)));
%             end
%         end
%        
%        figure
%        hold on;
%             plot(y,Eeq_plt,'LineWidth',2)
%             xlabel('Intercalation fraction [-]');
%             ylabel('Anode E^e^q [V]');
%             title('Graphite Open Circuit Voltage');
%             grid on;
%        hold off;
%        
%     end
end