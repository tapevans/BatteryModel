%% D_o_NMC532 
% NMC Diffusion Coefficient Function
    % X = intercalation fraction                                        [-]
    % c = constants (need universal gas constant)                       [-]
    % T = Temperature                                                   [K]
    %
    % Data taken from Verma et al. "Galvanostatic Intermittent 
    % Titration and Performance Based Analysis of 
    % LiNi0.5Co0.2Mn0.3O2 Cathode", J. Electrochem. Soc.
function [D_o] = D_o_NMC532_HZ(X , T)
    RR  = 8314.472; % [J kmol^-1 K^-1], Gas Constant

    % T       = SV(P.T , :);
    T_inv   = T.^-1;
    T_o     = 303.15;
    T_o_inv = T_o^-1;
    
    % Fit parameters
        A = [-2.509010843479270E+02; ...
              2.391026725259970E+03; ...
             -4.868420267611360E+03; ...
             -8.331104102921070E+01; ...
              1.057636028329000E+04; ...
             -1.268324548348120E+04; ...
              5.016272167775530E+03; ...
              9.824896659649480E+02; ...
             -1.502439339070900E+03; ...
              4.723709304247700E+02; ...
             -6.526092046397090E+01];

    % Expression for diffusion coefficient of NMC 532 [m^2 s^-1]
        D_o = 2.25*10.0.^(  A( 1)*X.^10 +A( 2)*X.^9 +A( 3)*X.^8 ...
                           +A( 4)*X.^7  +A( 5)*X.^6 +A( 6)*X.^5 ...
                           +A( 7)*X.^4  +A( 8)*X.^3 +A( 9)*X.^2 ...
                           +A(10)*X     +A(11)                ) ...
               .*exp(-30e6/RR* (T_inv - T_o_inv));
        D_o = D_o*1.0;
end

% The data is from 
% Galvanostatic Intermittent Titration and Performance Based Analysis of 
% LiNi0.5Co0.2Mn0.3O2 Cathode
% By: Ankit Verma et al 2017 J. Electrochem. Soc. 164 A3380

% data = [
% 0.35047106325706600, 2.7602275220902680e-11
% 0.35585464333781970, 2.6619313461261260e-11
% 0.36339165545087480, 2.5671356563109872e-11
% 0.36877523553162855, 2.5983530645064192e-11
% 0.37631224764468374, 2.4165851351732197e-11
% 0.38277254374158820, 2.5983530645064192e-11
% 0.38815612382234190, 2.5058215003503332e-11
% 0.40215343203230150, 2.4757157946593376e-11
% 0.41184387617765816, 2.2748636992297360e-11
% 0.42368775235531630, 2.3588667682042015e-11
% 0.43014804845222070, 2.2611569515367408e-11
% 0.43606998654104990, 2.3305266215984285e-11
% 0.44199192462987890, 2.4165851351732197e-11
% 0.44952893674293410, 2.1157254859620173e-11
% 0.45491251682368780, 2.2748636992297360e-11
% 0.46137281292059223, 2.1674945055821580e-11
% 0.47860026917900410, 2.2205302450155310e-11
% 0.49367429340511443, 2.1157254859620173e-11
% 0.50767160161507400, 2.2748636992297360e-11
% 0.51413189771197840, 2.1414535638539525e-11
% 0.52274562584118440, 2.1674945055821580e-11
% 0.53243606998654110, 2.1674945055821580e-11
% 0.53889636608344560, 2.0651929314796250e-11
% 0.54643337819650070, 2.2748636992297360e-11
% 0.55504710632570660, 2.2748636992297360e-11
% 0.56043068640646030, 2.0903065130645440e-11
% 0.56473755047106320, 2.1938521156974520e-11
% 0.57227456258411850, 2.1157254859620173e-11
% 0.58088829071332440, 1.9207222481239280e-11
% 0.58842530282637950, 1.9677197950210727e-11
% 0.59919246298788700, 2.0903065130645440e-11
% 0.61211305518169580, 2.0158673100702972e-11
% 0.62718707940780630, 1.7020453546420374e-11
% 0.63903095558546440, 1.9677197950210727e-11
% 0.65195154777927320, 1.6414327608105884e-11
% 0.65841184387617770, 1.7331858884240245e-11
% 0.66594885598923280, 1.4722413204302366e-11
% 0.67187079407806180, 1.6613932472747890e-11
% 0.68532974427994620, 1.3204893659559915e-11
% 0.69179004037685070, 1.5734407502856082e-11
% 0.69878869448183030, 1.4112576178114520e-11
% 0.70524899057873500, 1.5545369520127944e-11
% 0.71009421265141330, 1.4198124207339171e-11
% 0.71117092866756400, 1.3046246029575087e-11
% 0.71978465679676980, 1.3204893659559915e-11
% 0.72570659488559900, 1.2734645993249807e-11
% 0.73109017496635250, 1.3125330147352260e-11
% 0.73701211305518190, 1.2060486569996574e-11
% 0.74562584118438760, 1.2430488295695166e-11
% 0.75100942126514140, 1.1149209970080914e-11
% 0.76285329744279950, 1.4722413204302366e-11
% 0.76931359353970400, 1.2133595182097665e-11
% 0.77469717362045760, 1.1560912813835741e-11
% 0.78277254374158820, 1.0369266382873439e-11
% 0.78977119784656800, 1.2734645993249807e-11
% 0.79623149394347250, 1.0882919251371500e-11
% 0.80269179004037680, 1.2430488295695166e-11
% 0.81668909825033650, 1.1843793143187239e-11
% 0.82314939434724090, 9.0783150312649660e-12
% 0.83660834454912510, 1.3125330147352260e-11
% 0.84306864064602960, 1.1284788874077267e-11
% 0.85545087483176320, 1.3365470508911143e-11
% 0.86083445491251680, 1.1560912813835741e-11
% 0.86944818304172290, 1.0622988691548774e-11
% 0.87590847913862720, 1.1843793143187239e-11
% 0.88882907133243620, 9.0783150312649660e-12
% 0.89636608344549140, 9.7611573201832150e-12
% 0.90121130551816950, 8.9692453786727150e-12
% 0.90497981157469730, 8.2415803806891420e-12
% 0.91144010767160160, 7.4819663051388380e-12
% 0.91574697173620470, 7.0007465806975380e-12
% 0.91897711978465680, 6.3940242377738320e-12
% 0.92274562584118450, 5.8046966348054460e-12
% 0.92974427994616430, 4.9606439620529000e-12
% 0.93082099596231500, 4.3958677627086060e-12
% 0.93351278600269190, 3.8485916854796760e-12
% 0.93620457604306870, 3.4518963189386816e-12
% 0.93835800807537020, 3.1337402238589110e-12
% 0.94158815612382240, 2.6780675198281120e-12
% 0.94481830417227470, 2.4312340619997940e-12
% 0.94697173620457620, 2.2339907205444093e-12
% 0.95020188425302830, 1.9091493106981666e-12
% 0.95074024226110380, 1.6513828461826614e-12
% 0.95343203230148040, 1.3943023372816782e-12
% 0.95504710632570680, 1.0060618294027263e-12
% 0.95558546433378200, 1.1082032579150786e-12
% ];
% 
% %% Convert from cm^2/s to m^2 /s
% data(:,2)  = data(:,2) *1e-4;
% 
% %% Interpolating the data Test
% OG_size = size(X);
% X = reshape(X,[],1);
% D_o  = eXp(interp1(data(:,1) ,log(data(:,2)),X) );
% 
% %% Handle when X is out of range of the data
% idX  = isnan(D_o);
% for i = 1:length(X)
%     if (idX(i) && (X(i) < data(1,1)) )
%         D_o(i) = data(1,2);
%     elseif (idX(i) && (X(i) > data(end,1)) )
%         D_o(i) = data(end,2);
%     end
% end
% 
% %% Reshape the output
% D_o = reshape(D_o,OG_size);