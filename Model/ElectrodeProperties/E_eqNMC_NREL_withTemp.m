%% E_eqNMC
% E^eq (NMC)
function E_eq = E_eqNMC_NREL_withTemp(x,T)
    % Fit parameters
    A = [ 5.314735633000300E+00; ...
         -3.640117692001490E+03;...
          1.317657544484270E+04;...
         -1.455742062291360E+04;...
         -1.571094264365090E+03;...
          1.265630978512400E+04;...
         -2.057808873526350E+03;...
         -1.074374333186190E+04;...
          8.698112755348720E+03;...
         -8.297904604107030E+02;...
         -2.073765547574810E+03;...
          1.190223421193310E+03;...
         -2.724851668445780E+02;...
          2.723409218042130E+01;...
         -4.158276603609060E+00;...
         -5.573191762723310E-04;...
          6.560240842659690E+00;...
          4.148209275061330E+01];

    % Expression for OCV of NMC 532
    E_eq = A( 1).*x.^00 +A( 2).*x.^14 +A( 3).*x.^13 +A( 4).*x.^12 ...
          +A( 5).*x.^11 +A( 6).*x.^10 +A( 7).*x.^9  +A( 8).*x.^8  ...
          +A( 9).*x.^7  +A(10).*x.^6  +A(11).*x.^5  +A(12).*x.^4  ...
          +A(13).*x.^3  +A(14).*x.^2  +A(15).*x                   ...
          +A(16).*exp(A(17).*x.^A(18));
    
    % Temperature Adjustments
        p = [-0.007136 , 0.01314 , -0.003029 , -0.007028 , 0.004858 , -0.00104 , 2.823e-05];
        dUdT = p(1)*x.^6 + p(2)*x.^5 + p(3)*x.^4 + p(4)*x.^3 + p(5)*x.^2 + p(6)*x + p(7);
        T_ref  = 25 + 273.15;
        E_eq   = E_eq + (T - T_ref) .* dUdT;

%     % Plot the OCV if plotFlag == 1
%     if plotFlag == 1
%         y = linspace(0.2,1,100);
%         Eeq_plt= A( 1).*y.^00 +A( 2).*y.^14 +A( 3).*y.^13 +A( 4).*y.^12 ...
%                 +A( 5).*y.^11 +A( 6).*y.^10 +A( 7).*y.^9  +A( 8).*y.^8 ...
%                 +A( 9).*y.^7  +A(10).*y.^6  +A(11).*y.^5  +A(12).*y.^4 ...
%                 +A(13).*y.^3  +A(14).*y.^2  +A(15).*y                  ...
%                 +A(16).*exp(A(17).*y.^A(18));
%        
%        figure
%        hold on;
%             plot(y,Eeq_plt,'LineWidth',2)
%             xlabel('Intercalation fraction, x [-]');
%             ylabel('Cathode E^e^q [V]');
%             title('Li_xNi_0_._5Mn_0_._2Co_0_._3O_2 Open Circuit Voltage');
%             grid on;
%        hold off;
%        
%     end
end

% This is my old one and it looks the same
% E_eq = 5.314735633000300 ...
%     - 3640.117692001490*x.^14 ...
%     + 13176.57544484270*x.^13 ...
%     - 14557.42062291360*x.^12 ...
%     - 1571.094264365090*x.^11 ...
%     + 12656.30978512400*x.^10 ...
%     - 2057.808873526350*x.^9  ...
%     - 10743.74333186190*x.^8  ...
%     + 8698.112755348720*x.^7  ...
%     - 829.7904604107030*x.^6  ...
%     - 2073.765547574810*x.^5  ...
%     + 1190.223421193310*x.^4  ...
%     - 272.4851668445780*x.^3  ...
%     + 27.23409218042130*x.^2  ...
%     - 4.158276603609060*x     ...
%     - (5.573191762723310e-4)*exp(6.560240842659690*x.^41.48209275061330);